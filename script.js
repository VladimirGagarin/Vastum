"use strict";document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll("main section"),t=document.querySelector(".humburger-menu"),n=document.querySelector(".navigations"),o=document.querySelectorAll(".navigations ul li"),i=(document.querySelector(".logo-n-title-header"),document.querySelector(".music-headlines h2 span")),s=document.querySelector("#Home .mini-song-menu .progress-menu-truck .progress-menu-bar"),a=document.querySelector(".queued-songs-list"),r=document.querySelector("#QueuedSongs h2"),l=document.querySelector("#QueuedSongs p"),c=document.querySelector("#QueuedSongs .fallback-message"),d=c.querySelectorAll(".fallback-message .fallback-actions button")[0],u=c.querySelectorAll(".fallback-message .fallback-actions button")[1],m=document.querySelector("#About .playbtn-control"),g=document.querySelector("#Playlist .playlist-progress-truck .playlist-progres-bar"),p=document.querySelector(".loading-overlay"),f=document.querySelector("footer button"),y=document.querySelectorAll("#Home .music-container ul")[0],h=document.querySelectorAll("#Home .music-container ul")[1],b=document.querySelector("#Home .music-headlines .filter-button"),v=document.querySelector("#Home .music-container .playlist-titles button"),S=document.querySelector("#Playlist .play-song-field"),w=document.querySelector("#Playlist .quote-div"),k=document.querySelectorAll("#Playlist .actions-icons")[0],I=document.querySelectorAll("#Playlist .actions-icons")[1],A=document.querySelectorAll("#Playlist .actions-icons")[2],L=document.querySelectorAll("#Playlist .actions-icons")[3],q=document.querySelectorAll("#Playlist .actions-icons")[4],P=document.querySelectorAll("#Playlist .actions-icons")[5],E=document.querySelector("#Home  .mini-song-menu"),$=E.querySelectorAll(".min-controls button")[0],T=E.querySelectorAll(".min-controls button")[1],x=E.querySelectorAll(".min-controls button")[2],N=E.querySelectorAll(".min-controls button")[3],M=E.querySelector(".song-title"),j=document.querySelector(".confirmation-play-overlay"),H=j.querySelector(".confirmation-content .confirmation-text"),C=j.querySelectorAll(".confirmation-content .confirmations-button button")[0],U=j.querySelectorAll(".confirmation-content .confirmations-button button")[1],D=document.querySelector(".user-playlistform"),B=D.querySelector(".userp-header input"),O=D.querySelector(".userp-content .list-of-floders ul"),W=D.querySelector(".user-playlistform .userp-content .songs-field ul"),J=D.querySelectorAll(".user-playlistform .userp-content .userp-actions button")[0],R=D.querySelectorAll(".user-playlistform .userp-content .userp-actions button")[1],G=document.querySelector(".filter-options"),V=G.querySelector(".refresh-options-content .filter-options-header button"),F=G.querySelector(".refresh-options-content .refresh-content-lists ul"),Q=document.querySelector(".playlist-platform"),X=Q.querySelectorAll(".playlist-platform-header .playlist-platform-actions button")[0],z=Q.querySelectorAll(".playlist-platform-header .playlist-platform-actions button")[1],K=Q.querySelector(".playlist-platform-content .platforms-list ul"),_=document.querySelector(".auth-input"),Y=_.querySelector(".auth-input .auth-content input"),Z=_.querySelectorAll(".auth-input .auth-actions button")[0],ee=_.querySelectorAll(".auth-input .auth-actions button")[1],te=document.querySelector(".sharing-overlay"),ne=document.querySelector(".share-exit"),oe=document.querySelector(".sharing-overlay .sharing-content .sharing-icons"),ie=document.querySelector(".page-load");let se=[],ae={sid:null,index:null},re={pid:null,number:null},le=!1,ce=JSON.parse(sessionStorage.getItem("audioLoop"))||{lpid:null,looped:"false"},de={audio:null,sid:null,isPlaying:!1,ct:JSON.parse(sessionStorage.getItem("currentTime"))||{ctid:null,cttime:0},isLooping:ce},ue={audio:null,sid:null,isPlaying:!1,pttime:JSON.parse(sessionStorage.getItem("pcurrentTime"))||{pctid:null,ptime:0}},me={name:null,songsIds:[],pid:null},ge=!1,pe=JSON.parse(sessionStorage.getItem("songBatches")||"[]"),fe=JSON.parse(sessionStorage.getItem("playlistBatches")||"[]"),ye=JSON.parse(localStorage.getItem("LikedSongs")||"[]"),he=JSON.parse(localStorage.getItem("ListenedSongs")||"[]"),be=JSON.parse(localStorage.getItem("UserPlaylist")||"[]"),ve=null,Se=!1,we=[],ke=!1;const Ie=[{mood:"Upbeat",description:"Energetic and lively songs, often with a fast tempo and positive energy.",reader:"cantabile/reader1.mp3",img:"images/emoji2.jpg"},{mood:"Happy",description:"Cheerful and light-hearted songs, designed to boost your spirits.",reader:"cantabile/reader2.mp3",img:"images/emoji1.jpg"},{mood:"Sad",description:"Songs that evoke sadness or melancholy feelings.",reader:"cantabile/reader3.mp3",img:"images/emoji3.jpg"},{mood:"Romantic",description:"Songs that convey love, affection, and romantic emotions.",reader:"cantabile/reader4.mp3",img:"images/emoji4.jpg"},{mood:"Motivational",description:"Songs that inspire and encourage action, often used for workouts or personal growth.",reader:"cantabile/reader5.mp3",img:"images/emoji5.jpg"},{mood:"Relaxing",description:"Calm, soothing songs that help with relaxation or stress relief.",reader:"cantabile/reader6.mp3",img:"images/emoji6.jpg"},{mood:"Angry",description:"Songs that express frustration, rage, or strong emotions.",reader:"cantabile/reader7.mp3",img:"images/emoji7.jpg"},{mood:"Mellow",description:"Smooth and gentle songs that create a laid-back atmosphere.",reader:"cantabile/reader8.mp3",img:"images/emoji8.jpg"},{mood:"Dreamy",description:"Songs with a soft, ethereal, or otherworldly vibe.",reader:"cantabile/reader9.mp3",img:"images/emoji9.jpg"},{mood:"Nostalgic",description:"Songs that evoke memories of the past, often bittersweet.",reader:"cantabile/reader10.mp3",img:"images/emoji10.jpg"},{mood:"Epic",description:"Grand, powerful songs often used in movie soundtracks or anthems.",reader:"cantabile/reader11.mp3",img:"images/emoji11.jpg"},{mood:"Chill",description:"Laid-back, easy-going songs, often associated with relaxing moments.",reader:"cantabile/reader12.mp3",img:"images/emoji12.jpg"},{mood:"Party",description:"High-energy songs for social gatherings, clubs, or celebrations.",reader:"cantabile/reader13.mp3",img:"images/emoji13.jpg"},{mood:"Melancholic",description:"Songs that reflect deep sadness or a reflective, sorrowful mood.",reader:"cantabile/reader14.mp3",img:"images/emoji14.jpg"},{mood:"Hopeful",description:"Songs that convey optimism, anticipation, or positive aspirations.",reader:"cantabile/reader15.mp3",img:"images/emoji15.jpg"},{mood:"Sentimental",description:"Songs that evoke deep emotions and affection, often tied to memories.",reader:"cantabile/reader16.mp3",img:"images/emoji16.jpg"},{mood:"Peaceful",description:"Calm and serene songs, perfect for unwinding and inner peace.",reader:"cantabile/reader17.mp3",img:"images/emoji17.jpg"},{mood:"Intense",description:"Songs that are dramatic and full of energy, creating a sense of urgency.",reader:"cantabile/reader18.mp3",img:"images/emoji18.jpg"},{mood:"Fun",description:"Light-hearted and playful songs, often associated with good times and laughter.",reader:"cantabile/reader19.mp3",img:"images/emoji19.jpg"},{mood:"Euphoric",description:"Songs that evoke intense joy or bliss, often with a dance or trance feel.",reader:"cantabile/reader20.mp3",img:"images/emoji20.jpg"}],Ae=["Music is the rhythm of life, a melody that weaves through our souls, and a harmony that unites our hearts.","Every note is a heartbeat, every melody a story waiting to be heard.","Through music, we find not just sound, but the essence of life itself.","Life's beauty unfolds in the symphonies we create and the harmonies we share.","A single note can stir emotions that words could never express.","Music is the bridge that connects moments, memories, and dreams.","In every melody lies a whisper of the universe, reminding us of our shared humanity.","Life without music is like a canvas without color—silent and incomplete.","Music is not just sound; it’s a language of the soul that everyone understands.","The rhythm of life finds its pulse in the beats of a timeless melody.","In the silence between notes, we discover the beauty of the unknown.","Music is the timeless dance of emotion, weaving through the tapestry of life.","Through music, the past and present converse in perfect harmony.","A crescendo that transcends the bounds of eternity.","Melodies are the footprints of the heart, marking the journey of life."],Le="Left",qe="Right",Pe=[{albumName:"RnB",albumImage:"images/rnb.jpg",description:"Smooth, soulful tunes to set the mood right."},{albumName:"Airwave Music",albumImage:"images/airwave.jpg",description:"Feel the breeze of uplifting beats and serene melodies."},{albumName:"Chills",albumImage:"images/chills.jpg",description:"Relax and unwind with soothing and calming sounds."},{albumName:"Twilight",albumImage:"images/twilight.jpg",description:"Melodies as magical as the twilight hour."},{albumName:"Two Steps From Hell",albumImage:"images/hell.jpg",description:"Epic and inspiring orchestral masterpieces."},{albumName:"Classical",albumImage:"images/waltz.jpg",description:"Graceful rhythms for dreamy dances under the stars."},{albumName:"Disney",albumImage:"images/disney.jpg",description:"Magical tunes that spark joy and nostalgia."},{albumName:"Ncs",albumImage:"images/ncs.jpg",description:"Non-stop energy with no copyright beats."},{albumName:"Celine Dion",albumImage:"images/celine.jpg",description:"Iconic ballads and heartfelt anthems from the queen of vocals."},{albumName:"Bongo",albumImage:"images/bongo.jpg",description:"Vibrant African rhythms to get you moving."},{albumName:"Bollywood",albumImage:"images/bollywood.jpg",description:"Bollywood beats that bring drama and romance to life."},{albumName:"Others",albumImage:"images/others.jpg",description:"A mix of unique sounds for every curious ear."},{albumName:"Cool",albumImage:"images/cool.jpg",description:"Refreshing vibes to keep you chill."}];function Ee(t){e.forEach((e=>Te(e,"active",!1))),Te(e[t],"active",!0),ve=e[t],o.forEach((e=>Te(e,"active",!1)));const n=ve.id;document.title="AllegroVastum - Curated Music Collection | Personal Music Sanctuary",o.forEach((e=>{const t=e.getAttribute("data-match");t&&t===n&&Te(e,"active",!0)}));let i,s=0;i=setInterval((()=>{"About"===ve.id&&de&&de.audio&&(Te(m,"active",de.isPlaying),m.innerHTML=de.isPlaying?"&#10074;&#10074;":"&#9654;",s++,s>10&&clearInterval(i))}),500),"QueuedSongs"!==ve.id&&(ue&&ue.audio&&(ue.audio.pause(),ue.isPlaying=!1),le=!1,ke=!1),le||"QueuedSongs"===ve.id?function(e,t){const n="null"===e||"undefined"===e?null:e,o="NaN"===t||"null"===t?NaN:Number(t);if(Ye(),!n||isNaN(o))return void Te(c,"active",!0);$e();const i=we.find((e=>e.pid===n));if(i){const e=se.filter((e=>i.songIds.includes(e.songId)));re.number=o>i.songIds.length?1:o,rt(i,e,re.number)}else Ee(0)}(re.pid,re.number):Je(ae.sid,ae.index),$e(),m.onclick=()=>{de&&de.audio&&(de.isPlaying?(de.audio.pause(),de.isPlaying=!1):(de.audio.play(),de.isPlaying=!0)),m.innerHTML=de.isPlaying?"&#10074;&#10074;":"&#9654;",et(de.isPlaying)}}function $e(){const e=ve.getAttribute("data-url"),t=new URLSearchParams(window.location.search);t.set("note",e),t.set("sid",ae.sid),t.set("index",ae.index),t.set("pid",re.pid),t.set("number",re.number);const n=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({section:e,songDetails:{sid:ae.sid,index:ae.index},playlistDetails:{pid:re.pid,number:re.number}},"",n)}function Te(e,t,n){e.classList.toggle(t,n)}function xe(e,t){sessionStorage.setItem(t,JSON.stringify(e))}function Ne(e,t){localStorage.setItem(t,JSON.stringify(e))}fetch("audio.json").then((e=>{if(!e.ok)throw new Error;return e.json()})).then((t=>{se.unshift(...t),Ke(),function(){if(fe.length>0)return;let e=[];Ie.forEach((t=>{let n=se.filter((e=>Array.isArray(e.songMood)&&e.songMood.includes(t.mood)));if(n.length>0){let o=We(n),i=o.length>10?o.slice(0,o.length/2):o,s={name:t.mood,songIds:i.map((e=>e.songId)),pid:crypto.randomUUID(),pImg:t.img,system:!0,tooltip:t.description};e.unshift(s)}})),fe=[...e],xe(fe,"playlistBatches")}(),function(){const t=new URLSearchParams(window.location.search),n=t.get("note"),o=t.get("sid"),i=t.get("index"),s=t.get("pid"),a=t.get("number");ae.sid=o,ae.index=parseInt(i),re.pid=s,re.number=parseInt(a);const r=Array.from(e).findIndex((e=>e.getAttribute("data-url")===n));Ee(-1!==r?r:0)}(),setTimeout((()=>{Te(ie,"loaded",!0)}),6e3)})).catch((e=>{console.error(e)})),window.addEventListener("popstate",(t=>{if(t.state){const n=t.state.section,o=Array.from(e).findIndex((e=>e.getAttribute("data-url")===n)),i=t.state.songDetails||{},s=i.sid||"",a=parseInt(i.index)||0;ae.sid=s,ae.index=parseInt(a),Ee(-1!==o?o:0)}}));const Me=e=>Math.floor(Math.random()*e),je=document.createElement("div");je.classList.add("tooltip-text"),je.style.position="fixed",je.style.display="none",document.body.appendChild(je);const He=(e,t,n)=>{n?(je.innerHTML=`<p>${e}</p>`,je.style.left=`${t.clientX+15}px`,je.style.top=t.clientY-25+"px",je.style.display="block"):je.style.display="none"},Ce=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60),i=n<10?`0${n}`:n,s=o<10?`0${o}`:o;if(t>0){return`${t<10?`0${t}`:t}hrs : ${i} min : ${s} sec`}return`${i} : ${s}`};function Ue(...e){const t=document.querySelector(".movable-menu");Te(t,"active",!0),t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");n.classList.add("menu-items"),n.innerHTML=`<p><span>${e.icon}</span>${e.text}</p>`,t.appendChild(n),n.onclick=()=>{e.callback&&"function"==typeof e.callback&&e.callback(),Te(t,"active",!1)}})),document.addEventListener("click",(()=>Te(t,"active",!1)),{once:!0})}window.addEventListener("offline",(function(){de&&de.audio&&de.isPlaying&&(de.audio.pause(),ge=!0,currentAudio.isPlaying=!1),window.location.href="offline/"})),window.addEventListener("online",(function(){ge&&de&&de.audio&&(de.audio.pause(),de.isPlaying=!0,ge=!1),window.location.href="index.html"})),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("service-worker.js").then((e=>{console.log("Service Worker registered:",e)})).catch((e=>{console.error("Service Worker registration failed:",e)}))}));const De=e=>{const t=e.songGenre,n=Pe.find((e=>e.albumName===t));return n?n.albumImage:null},Be=(e,t)=>{H.innerHTML=`<p>${e}</p>`,Te(j,"active",!0),C.onclick=()=>{t(),Te(j,"active",!1)},U.onclick=()=>{Te(j,"active",!1),ve&&"Playlist"===ve.id&&Ee(0)}};function Oe(e,t){ae.sid=e,ae.index=t,le=!0,$e(),Ze(t);const n=se.find((e=>e.songId===ae.sid));n&&function(e,t){const n=t-1;M.innerHTML=`<p>${t}.${e.songKeyWord}</p>`,Te(E,"active",!0),document.title=t+".  "+e.songName;const o=new Audio(e.songUrl);(function(e){de&&de.audio&&de.audio!==e&&(de.audio.pause(),de.isPlaying=!1,de.ct={ctid:null,cttime:0},de.audio.muted=!1,de.audio.loop=!1,Te(L,"active",!1),Te(P,"active",!1));de.audio=e,de.sid=ae.sid;const t=de.ct,n=se.find((e=>e.songId===de.sid));if(de.isLooping.lpid===de.sid){let e="true"===de.isLooping.looped;de.audio.loop=e,Te(L,"active",e),Te(N,"active",e),e?(N.click(),N.innerHTML='<i class="fa-solid fa-rotate-left"></i>',L.innerHTML='<i class="fa-solid fa-rotate-left"></i>'):(N.innerHTML='<i class="fa-solid fa-repeat"></i>',L.innerHTML='<i class="fa-solid fa-repeat"></i>')}else de.audio.loop=!1,Te(L,"active",!1),Te(N,"active",!1),tt(!1);t.ctid===de.sid&&(de.audio.currentTime=t.cttime);de.audio.play().catch((e=>{const o=`Do you want to ${t.cttime>0?"Resume":"Play"} ${n?n.songName:""}`;Be(o,(()=>{de.audio.play()}))})),de.audio.addEventListener("playing",(()=>{de.isPlaying=!0,et(!0),Te(j,"active",!1),Te(p,"active",!1),document.title=ae.index+".  "+n.songName})),de.audio.addEventListener("timeupdate",(()=>{!function(){if(de&&de.audio){const e=de.audio.duration,t=de.audio.currentTime,n=t/e*100;s.style.width=`${n}%`,g.style.width=`${n}%`,S.innerHTML=`<span>${Ce(t)}</span> / <span>${Ce(e)??"00:00"}</span>`}}()})),de.audio.addEventListener("error",(()=>{de.isPlaying=!1,et(!1),Te(p,"active",!0),document.title="Error Playing Song";const e=`The song ${n?n.songName:""} isn't available. Can we Play next`;Be(e,(()=>{const e=y.querySelectorAll("li");if(ae&&ae.index){const t=ae.index;0===t&&st(Le),t<e.length&&st(qe)}}))})),de.audio.addEventListener("waiting",(()=>{de.isPlaying=!1,et(!1),Te(p,"active",!0),document.title="Just a moment..."})),de.audio.addEventListener("stalled",(()=>{de.isPlaying=!1,et(!1),Te(p,"active",!0),document.title="Just a moment..."})),de.audio.addEventListener("ended",(()=>{de.isPlaying=!1,s.style.width=0,et(!1),Te(p,"active",!1);const e=de.audio.loop;if(document.title="AllegroVastum - Curated Music Collection | Personal Music Sanctuary",!e){const e=y.querySelectorAll("li");if(ae&&ae.index){ae.index<e.length&&st(qe)}}const t=new Set(he);t.add(de.sid),t.size>200&&t.clear(),he=[...t]})),window.addEventListener("beforeunload",(()=>{xe({ctid:de.sid,cttime:de.audio.currentTime},"currentTime")})),g.parentElement.onclick=e=>{const t=g.parentElement.clientWidth,n=e.offsetX,o=de.audio.duration;de.audio.currentTime=n/t*o}})(o),function(e){const t=y.querySelectorAll("li");x.disabled=e===t.length-1,$.disabled=0===e}(n)}(n,t);const o=ae.sid,i=ye.find((e=>e===o));Te(q,"Love",!!i)}const We=e=>{let t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t};function Je(e,t){const n="null"===e?null:e,o="NaN"===t?NaN:t;if(Ye(),!n&&isNaN(o)&&pe.length>0)return sessionStorage.removeItem("currentTime"),void _e();if(de?.audio&&de?.isPlaying)return;const i=pe.find((t=>t===e));if(i){const e=se.find((e=>e.songId===ae.sid)),t=pe.indexOf(n)+1;if(e){let e;ae.index=t,Ze(t),_e(),de&&(e=de.ct.cttime),Oe(i,t)}}else{const n=se.find((t=>t.songId===e));if(n){const e=n.songId;pe.find((t=>t===e))||(t>pe.length?(pe.push(e),t=pe.length):pe.splice(t-1,0,e),ae.sid=e,ae.index=t,$e(),_e(),Ze(t),Oe(e,t));if(pe.some((t=>t===e))){let n;xe(pe,"songBatches"),_e(),Ze(t),de&&(n=de.ct.cttime),Oe(e,t)}}else _e()}}t.onclick=e=>{e.stopPropagation(),Se=!Se,Te(n,"active",Se),document.addEventListener("click",(e=>{e.target.classList.contains(".navigations")||(Se=!1,Te(n,"active",Se),Te(t,"active",Se))}),{once:!0}),Te(t,"active",Se)},o.forEach((t=>{t.onclick=()=>{const o=t.getAttribute("data-match"),i=Array.from(e).findIndex((e=>e.id===o));Ee(-1!==i?i:0),Te(n,"active",!1),Se=!1}}));const Re=["#5bc589","#7ea10a","#1f95cc","#f9f9f9","#2eeb80","#e4b43d","#3dda9b","#cca34d"],Ge=["#0b0a30","#1a1e3f","#1b2a41","#241c1c","#1e2d24","#2d1e40","#0f2c2c","#2a0d1f","#171a21","#0d0c1d","#1a1b2f","#2c1f33","#13232f","#101820","#2e1a47"],Ve=document.querySelector(".mini-song-menu");let Fe,Qe=!1,Xe=0,ze=0;function Ke(){const e=[],t=We(se);for(let t=20;t<=81;t++)t%4==0&&t%3==0&&e.push(t);const n=e[Me(e.length)];let o=[];const i=[{fname:"20randomSelector",action:()=>{for(let e=0;e<20;e++){const e=Me(se.length);o.push(t[e])}}},{fname:"topN",action:()=>{o.push(...t.slice(0,20))}},{fname:"bottomN",action:()=>{o.push(...t.slice(-20))}},{fname:"evenItems",action:()=>{o.push(...t.filter(((e,t)=>t%2==0)).slice(0,20))}},{fname:"oddItems",action:()=>{o.push(...t.filter(((e,t)=>t%2!=0)).slice(0,20))}},{fname:"shuffleN",action:()=>{let e=We([...t]);o.push(...e.slice(0,10))}},{fname:"genreBased",action:()=>{let e=t[Me(t.length)]?.songGenre||"Unknown",n=t.filter((t=>t.songGenre===e));o.push(...n.slice(0,10))}},{fname:"moodBased",action:()=>{let e=t[Me(t.length)]?.songMood||"Unknown",n=t.filter((t=>Array.isArray(t.songMood)&&t.songMood.includes(e)));o.push(...n.slice(0,10))}},{fname:"Epic",action:()=>{let e=Ie[10].mood,n=t.filter((t=>t.songMood===e));o.push(...n.slice(0,n.length>20?20:n.length))}},{fname:"randomAlbum",action:()=>{let e=Pe[Me(Pe.length)].albumName,n=t.filter((t=>t.songGenre===e));o.push(...n.slice(0,20))}},{fname:"randomArtist",action:()=>{let e="Thomas Bergersen",n=t.filter((t=>t.songArtist1===e||t.songArtist2===e));o.push(...n.slice(0,n.length>10?10:n.length))}},{fname:"Tsfh",action:()=>{let e=t.filter((e=>"Two Steps From Hell"===e.songGenre));o.push(...e.slice(0,e.length>20?20:e.length))}},{fname:"Rnbs",action:()=>{let e=t.filter((e=>"RnB"===e.songGenre));o.push(...e.slice(0,e.length>20?20:e.length))}}];if(0===pe.length){i.forEach((e=>{"function"==typeof e.action&&e.action()})),o=[...new Map(o.map((e=>[e.songId,e]))).values()];const e=We(o),t=new Set(he),s=e.filter((e=>!t.has(e.songId))).map((e=>e.songId)).slice(0,n);pe.unshift(...s),xe(pe,"songBatches")}}function _e(){y.innerHTML="",pe.forEach(((e,t)=>{const n=se.find((t=>t.songId===e));n&&function(e,t){if(!e)return;const n=document.createElement("li");n.setAttribute("data-song-label",e.songId);const o=De(e);n.title=`${e.songName} - ${e.songArtist1} & ${e.songArtist2?e.songArtist2:""}`;const i="dark"===getComputedStyle(document.documentElement).getPropertyValue("--user-prefer-color").trim()?Ge:Re;n.style.background=i[Me(i.length)],n.innerHTML=`\n            <div class="song-name">\n            <span><strong>${t+1}</strong>. ${e.songKeyWord}</span>\n            </div>\n            <div class="song-image">\n            <img src="${o}" alt="${e.songId}">\n            </div>\n            <div class="song-detail">\n            <span>&hellip;</span>  \n            </div>`,y.appendChild(n);const s=n.querySelector(".song-detail"),a=[{text:"Play",callback:()=>{de&&de.audio&&(de.audio.pause(),de.isPlaying=!1);const e=Array.from(y.querySelectorAll("li")).findIndex((e=>e.getAttribute("data-song-label")===r));-1!==e&&Oe(r,e+1)},icon:"&#9654;"},{text:"Add to Playlist",callback:()=>{l()},icon:"&#10010;"},{text:"Like",icon:"&#10084;",callback:()=>{const e=ye.find((e=>e===r));e?ye=ye.filter((e=>e!==r)):ye.push(r),Te(q,"Love",!e),xe(ye,"LikedSongs"),Ye()}},{text:"Download",callback:()=>{c(e)},icon:"&#8681;"},{text:"Share",callback:()=>{d(e)},icon:"&#128206;"}];s.onclick=e=>{e.preventDefault(),e.stopPropagation(),Ue(...a)};const r=e.songId;function l(){K.innerHTML="";if(0!==be.filter((e=>!e.system)).length)be.forEach((n=>{if(n.system)return;const o=document.createElement("li");o.setAttribute("data-playlist-label",n.pid);const i=n.songIds.includes(e.songId);o.innerHTML=`<span>${n.name}</span> <input type="checkbox" id="${n.pid}" ${i?"checked":""} />`,K.appendChild(o);const s=o.querySelector('input[type="checkbox"]');o.onclick=e=>{e.stopPropagation(),s.checked=!s.checked,t()},s.onclick=i=>{i.stopPropagation();const a=s.checked;a?n.songIds.push(e.songId):n.songIds=n.songIds.filter((t=>t!==e.songId)),n.songIds=[...new Set(n.songIds)],Te(o,"checked",a),t()}})),Te(Q,"active",!0),t(),X.onclick=()=>{Ne(be,"UserPlaylist"),Te(Q,"active",!1),Ye()},z.onclick=()=>{Te(Q,"active",!1)};else{Te(Q,"active",!1);Be("Your playlist shelf is empty for now. Shall we create your first one together?",(()=>nt()))}function t(){const e=Array.from(K.querySelectorAll('input[type="checkbox"]')).some((e=>e.checked));X.disabled=!e}}function c(e){const t="Lorem_Ipsum_Dolor_100";Te(_,"active",!0),Y.oninput=()=>{const e=Y.value.trim();Z.disabled=0===e.length},ee.onclick=()=>{Y.value="",Z.disabled=!0,Te(_,"active",!1)},Z.onclick=()=>{if(Y.value.trim()===t){const t=document.createElement("a");t.href=e.songUrl,t.download=`${e.songKeyWord} - ${e.songArtist1}.mp3`,document.body.appendChild(t),t.click(),Y.value="",document.body.removeChild(t),Z.disabled=!0,Te(_,"active",!1)}else Y.value="",Z.disabled=!0,Te(_,"active",!1),Y.placeholder="Wrong Password",setTimeout((()=>{Y.placeholder="Enter Password"}),2e3),Y.focus()}}function d(e){Te(te,"active",!0),ne.onclick=()=>{Te(te,"active",!1)};const t=e.songName,n=e.songArtist1,o=e.songArtist2?", "+e.songArtist2:"",i=De(e),s=e.songId,a=window.location.pathname,r=`${window.location.origin}${a.replace(/\/$/,"")}/share/?sid=${encodeURIComponent(s)}`;oe.innerHTML="";const l=document.createElement("div");l.classList.add("share-preview"),l.innerHTML=`\n                <div class="share-box">\n                    <div" class="share-link">\n                        <img src="${i}" alt="Album Art">\n                        <div class="share-text">\n                            <span>${n}${o}</span>\n                            <strong>${t}</strong>\n                        </div>\n                    </div>\n                    <div class="copy-link-section">\n                        <input type="text" value="${r}" id="copySongLinkInput" readonly />\n                        <button id="copySongLinkBtn">Copy Link</button>\n                    </div>\n                </div>\n            `,oe.appendChild(l),setTimeout((()=>{const e=document.getElementById("copySongLinkBtn"),t=document.getElementById("copySongLinkInput");t.readOnly=!0,e.onclick=async()=>{try{await navigator.clipboard.writeText(t.value),e.innerText="Copied!",setTimeout((()=>e.innerText="Copy Link"),2e3)}catch(t){console.error("Failed to copy: ",t),e.innerText="Failed",setTimeout((()=>e.innerText="Copy Link"),2e3)}}}),100)}let u;function m(){u&&u.disconnect(),u=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){!function(e){const t=document.createElement("div");t.className="bottom-tooltip",t.innerHTML=`<span>${e}</span>`,document.body.appendChild(t),setTimeout((()=>{t.classList.add("visible")}),10),setTimeout((()=>{t.classList.remove("visible"),setTimeout((()=>{t.remove()}),300)}),3e3)}(e.target.dataset.songName)}}))}),{root:null,threshold:.8});y.querySelectorAll("li").forEach((e=>{const t=e.getAttribute("data-song-label"),n=se.find((e=>e.songId===t));n&&(e.dataset.songName=`${n.songName} - ${n.songArtist1} ${n.songArtist2?" & "+n.songArtist2:""}`),u.observe(e)}))}function g(){window.innerWidth<768?m():u&&u.disconnect()}n.onclick=()=>{const e=Array.from(y.querySelectorAll("li")).findIndex((e=>e.getAttribute("data-song-label")===r));-1!==e&&Oe(r,e+1)},n.onmouseover=t=>{const n=`${e.songName} - ${e.songArtist1} ${e.songArtist2?" & "+e.songArtist2:""}`;He(n,t,!0)},n.onmouseleave=e=>{He("",e,!1)},n.onmousemove=t=>{const n=`${e.songName} - ${e.songArtist1}  ${e.songArtist2?" & "+e.songArtist2:""}`;He(n,t,!0)},n.onmouseout=e=>{He("",e,!1)},n.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation(),Ue(...a)},window.innerWidth<768&&m();window.addEventListener("resize",g)}(n,t)})),i.textContent=`${pe.length} songs`}function Ye(){if(h.innerHTML="",we=[...fe],ye=ye.filter((e=>null!==e)),Array.isArray(ye)&&ye.length>0){let e={name:"Liked Songs",songIds:ye,pid:localStorage.getItem("likedSongsPid")||crypto.randomUUID(),pImg:"logo.png",system:!0,tooltip:"Songs you love belong on your shelf"};localStorage.setItem("likedSongsPid",e.pid),Array.isArray(we)||(we=[]),we.unshift(e)}if(be.length>0&&(be=We(be),we=[...be,...we]),0===we.length)return console.warn("No playlists available to render."),h.innerHTML="<p>No playlists found</p>",void Te(c,"active",!0);we.forEach((e=>{!function(e){if(!e)return;const t=document.createElement("li");t.setAttribute("data-playlist-label",e.pid);const n=e.pImg||"logo.png";t.innerHTML=`\n             <div class="song-name">\n                 <span>${e.name}</span>\n             </div>\n             <div class="song-image">\n                <img src="${n}" alt="Playlist Image" onError="this.onerror=null;this.src='logo.png';">\n\n             </div>\n             <div class="song-detail">\n              <span>Playlist ( ${e.songIds.length} songs )</span>\n             </div>`,h.appendChild(t),e.tooltip&&(t.onmouseenter=t=>{He(e.tooltip,t,!0)},t.onmouseover=t=>{He(e.tooltip,t,!0)},t.onmouseleave=e=>{He("",e,!1)},t.onmousemove=t=>{He(e.tooltip,t,!0)},t.onmouseout=e=>{He("",e,!1)});t.onclick=()=>{if(!e)return void console.error("Playlist object is undefined!");Ee(3);const t=se.filter((t=>e.songIds.includes(t.songId)));rt(e,t,1)}}(e)}))}function Ze(e){const t=e-1,n=y.querySelectorAll("li"),o=n[t];n.forEach((e=>Te(e,"Playing",!1))),n.forEach((e=>{const t=e.querySelector(".song-detail");t&&t.classList.remove("disabled")}));const i=Array.from(n).findIndex((e=>e.getAttribute("data-song-label")===o.getAttribute("data-song-label")));if(-1!==i){Te(n[i],"Playing",!0);const e=n[i].querySelector(".song-detail");e&&e.classList.add("disabled"),n[i].oncontextmenu=e=>{e.preventDefault()},n[i].scrollIntoView({behavior:"smooth",block:"center"})}at()}function et(e){T.innerHTML=e?"&#10074;&#10074;":"&#9654;",k.innerHTML=e?"&#10074;&#10074;":"&#9654;",Te(k,"active",e),Te(T,"active",e)}function tt(e){x.disabled=e,$.disabled=e}function nt(){O.innerHTML="",W.innerHTML="",Pe.forEach((e=>{const t=document.createElement("li");t.textContent=e.albumName,O.appendChild(t)})),Te(D,"active",!0);const e=O.querySelectorAll("li");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>Te(e,"active",!1))),Te(t,"active",!0);const n=t.textContent.trim(),o=se.filter((e=>e.songGenre===n));o.length>0&&(W.innerHTML="",o.forEach(((e,t)=>{!function(e,t){const n=document.createElement("li");n.title=e.songName,n.innerHTML=`<span>${t}. ${e.songKeyWord}</span><input type="checkbox"title="${e.songName}">`,W.appendChild(n);const o=n.querySelector("input");o.onchange=()=>{o.checked?me.songsIds.unshift(e.songId):me.songsIds=me.songsIds.filter((t=>t!==e.songId)),ot()}}(e,t+1)})))}))})),R.onclick=()=>Te(D,"active",!1),B.oninput=()=>ot()}function ot(){J.disabled=""===B.value.trim()||0===me.songsIds.length}function it(){if(de&&de.audio){if(!de.audio)return;de.audio.addEventListener("error",(()=>{})),de.audio.addEventListener("stalled",(()=>{})),de.isPlaying?(de.audio.pause(),et(!1),de.isPlaying=!1):(de.audio.play(),et(!0),de.isPlaying=!0)}}function st(e){const t=y.querySelectorAll("li");let n=null;if(ae&&ae.index)n=ae.index-1;else{const e=Array.from(t).findIndex((e=>e.classList.contains("Playing")));-1!==e&&(n=e)}if(e===qe&&(n+=1,n<t.length)){Oe(t[n].getAttribute("data-song-label"),n+1)}if(e===Le&&(n-=1,n>=0)){Oe(t[n].getAttribute("data-song-label"),n+1)}}function at(){if(ae&&ae.sid){const e=se.find((e=>e.songId===ae.sid));if(e){const t=De(e);S.parentElement.style.backgroundImage=`url('${t}')`,w.innerHTML=`<h2>${e.songName}</h2><span>${Ae[Me(Ae.length)]}</span>`}Te(q,"Love",!1);const t=ae.sid,n=ye.find((e=>e===t));Te(q,"Love",!!n)}}function rt(e,t,n){le=!0,re.pid=e.pid,re.number=n,isNaN(re.number)&&(re.number=1),a.innerHTML="",de&&de.audio&&(de.audio.pause(),de.isPlaying=!1,et(!1),de.audio=null),t.length>0&&Te(c,"active",!1),t.forEach(((e,t)=>function(e,t){const n=re.pid,o=document.createElement("div");o.classList.add("queued-songs-list-item"),o.setAttribute("data-code",e.songId);const i=we.find((e=>e.pid===n.pid))?.pImg||"logo.png";o.innerHTML=`\n           <div class="left-item">\n                <h3><strong>${t+1}</strong>. ${e.songName}</h3>\n                <span></span>\n                <div class="progress-truck">\n                <div class="progress-bar"></div>\n            </div>\n            </div>\n            <div class="right-item">\n                <div class='play-btn'>\n                <span> &#9654;</span>\n                </div>\n            </div>`,a.appendChild(o);const s=o.querySelector(".right-item .play-btn");s.style.backgroundImage=`url('${i}')`;const r=e.songId,l=se.find((e=>e.songId===r));s.onclick=()=>{if(ue&&ue.sid&&ue.sid===o.getAttribute("data-code"))ue.isPlaying?(ue.audio.pause(),ue.isPlaying=!1,dt(s.querySelector("span"),!1)):(ue.audio.play(),ue.isPlaying=!0,dt(s.querySelector("span"),!0));else if(l){const t=Array.from(a.querySelectorAll(".queued-songs-list-item")).findIndex((t=>t.getAttribute("data-code")===e.songId));-1!==t&&lt(l,t+1)}}}(e,t))),lt(t[re.number-1],re.number),r.textContent=e.name;const o=Ie.find((t=>t.mood===e.name));l.textContent=o?o.description:"From your playlist.Enjoy!"}function lt(e,t){const n=t-1;re.number=t,function(e){const t=a.querySelectorAll(".queued-songs-list-item");t.forEach((e=>Te(e,"active",!1))),Te(t[e],"active",!0),t[e].scrollIntoView({behavior:"smooth",block:"center"}),t.forEach((e=>{dt(e.querySelector(".right-item .play-btn span"),!1);e.querySelector(".left-item span").innerHTML="";e.querySelector(".left-item .progress-truck .progress-bar").style.width=0}))}(n);const o=new Audio(e.songUrl),i=a.querySelectorAll(".queued-songs-list-item");ue&&ue.audio&&(ue.audio.pause(),ue.isPlaying=!1),function(e,t,n){const o=n.querySelector(".right-item .play-btn span"),i=n.querySelector(".left-item span"),s=n.querySelector(".left-item .progress-truck .progress-bar"),r=n.querySelector(".left-item .progress-truck");ue&&ue.audio&&ue.sid&&ue.sid!==t&&(ue.audio.pause(),ue.isPlaying=!1,dt(o,ue.isPlaying),ue.pttime.ptime=0);ue.audio=e,ue.sid=t,ue&&ue.pttime.pctid===t||(ue.pttime.ptime=0),ue.audio.currentTime=ue.pttime.ptime;ue.audio.play().catch((e=>{const n=se.find((e=>e.songId===t)),o=`do you want to Play the song: ${n?n.songName:""}`;Be(o,(()=>{ue&&ue.audio&&(ue.audio.play(),ue.isPlaying=!0)}))})),dt(o,ue.isPlaying),ue.audio.addEventListener("waiting",(()=>{ue.isPlaying=!1,dt(o,ue.isPlaying),Te(p,"active",!0)})),ue.audio.addEventListener("timeupdate",(()=>{const e=ue.audio.duration?ue.audio.duration:0;i.innerHTML=`<strong>${Ce(ue.audio.currentTime)}</strong> / <b>${Ce(e)??"00:00"}</b>`,s.style.width=ue.audio.currentTime/ue.audio.duration*100+"%"})),ue.audio.addEventListener("playing",(()=>{ue.isPlaying=!0,dt(o,ue.isPlaying),j&&Te(j,"active",!1),Te(p,"active",!1)})),ue.audio.addEventListener("stalled",(()=>{ue.isPlaying=!1,ue.pttime.ptime=ue.audio.currentTime,ue.audio.pause(),ue.audio.currentTime=ue.pttime.ptime,ue.audio.muted=!1,dt(o,ue.isPlaying),Te(p,"active",!0)})),ue.audio.addEventListener("ended",(()=>{i.textContent="",s.style.width=0,ue.isPlaying=!1,ue.pttime.ptime=0,ue.audio.muted=!1,dt(o,!1),ue.audio.currentTime=0;let e=re.number;const t=a.querySelectorAll(".queued-songs-list-item");if(e===t.length&&(ke=!0),ke)if(e>0){e-=1;const n=t[e-1].getAttribute("data-code");if(we.find((e=>e.pid===re.pid))){lt(se.find((e=>e.songId===n)),e)}}else ke=!1,e=1,re.number=e,ct("forward");else e<t.length&&ct("forward");Te(o,"active",!1),Te(p,"active",!1),Te(j,"active",!1)})),r.onclick=e=>{const t=r.clientWidth,n=e.offsetX,o=ue.audio.duration;ue.audio.currentTime=n/t*o},document.addEventListener("keydown",(e=>{e.preventDefault(),"ArrowUp"===e.code&&ct("backward"),"ArrowDown"===e.code&&ct("forward")}),{once:!0}),window.addEventListener("beforeunload",(()=>{xe({pctid:ue.sid,ptime:ue.audio.currentTime},"pcurrentTime")}))}(o,e.songId,i[n]),$e();!function(e,t){const n=De(t),o=document.querySelector("#QueuedSongs"),i=getComputedStyle(document.documentElement).getPropertyValue("--user-prefer-color").trim(),s="dark"===i?Ge:Re;o.style.backgroundColor=s[e];const a=new Image;a.src=n,a.onload=()=>{o.style.backgroundImage=`url(${n})`},a.onerror=()=>{o.style.backgroundImage="",o.style.backgroundColor=s[e]}}(t%("dark"===getComputedStyle(document.documentElement).getPropertyValue("--user-prefer-color").trim()?Ge:Re).length,e)}function ct(e){let t=re.number;const n=a.querySelectorAll(".queued-songs-list-item");if("forward"===e&&t<n.length){t+=1;const e=n[t-1].getAttribute("data-code"),o=we.find((e=>e.pid===re.pid));if(o){console.log("playlist",o);lt(se.find((t=>t.songId===e)),t)}}if("backward"===e&&t>0){t-=1;const e=n[t-1].getAttribute("data-code");if(we.find((e=>e.pid===re.pid))){lt(se.find((t=>t.songId===e)),t)}}}function dt(e,t){e.innerHTML=t?"&#10074;&#10074;":"&#9654;"}Ve.addEventListener("mousedown",(e=>{Qe=!0,Xe=e.clientX-ze,Ve.style.transition="none",Ve.style.cursor="grabbing"})),document.addEventListener("mousemove",(e=>{if(Qe){const t=e.clientX;ze=t-Xe;const n=window.innerWidth-Ve.offsetWidth;ze<0?ze=0:ze>n&&(ze=n),Ve.style.left=`${ze}px`}})),document.addEventListener("mouseup",(()=>{Qe=!1,Ve.style.transition="left 0.3s ease",Ve.style.cursor="grab"})),b.onclick=e=>{e.stopPropagation(),F.innerHTML="",Pe.forEach(((e,t)=>{const n=document.createElement("li");n.innerHTML=`<span>${t+1}. ${e.albumName}</span> <img src="${e.albumImage}" alt="${e.description}" title="${e.description}">`,F.appendChild(n),n.onclick=()=>{const t=se.filter((t=>t.songGenre===e.albumName)),n=We(t);pe=[...n.map((e=>e.songId))],xe(pe,"songBatches"),Be("Do you really want to refresh your recommendation ?",(()=>{_e(),de&&de.audio&&(de.audio.pause(),de.isPlaying=!1,et(!1)),le=!1,ae.sid=pe[0],ae.index=1,Ee(0),Je(ae.sid,ae.index)}))}})),Te(G,"active",!0),V.onclick=()=>{Te(G,"active",!1),sessionStorage.removeItem("songBatches"),Ke();const e=pe[0],t=se.find((t=>t.songId===e));t&&(ae.sid=t.songId,ae.index=1,Je(ae.sid,ae.index)),window.location.reload()},document.addEventListener("click",(e=>{e.target.classList.contains(".filter-options .refresh-options-content")||Te(G,"active",!1)}))},T.onclick=()=>it(),k.onclick=()=>it(),x.onclick=()=>st(qe),$.onclick=()=>st(Le),M.onclick=()=>{Ee(1),at()},N.onclick=()=>{if(de.audio){let e=!de.audio.loop;de.audio.loop=e;const t={lpid:de.sid,looped:e?"true":"false"};sessionStorage.setItem("audioLoop",JSON.stringify(t)),de.isLooping=t,Te(L,"active",e),Te(N,"active",e),tt(e),x.disabled=e,$.disabled=e}},A.onclick=()=>st(qe),I.onclick=()=>st(Le),L.onclick=()=>{if(de.audio){let e=!de.audio.loop;de.audio.loop=e;const t={lpid:de.sid,looped:e?"true":"false"};sessionStorage.setItem("audioLoop",JSON.stringify(t)),de.isLooping=t,Te(L,"active",e),Te(N,"active",e),tt(e),x.disabled=e,$.disabled=e}},P.onclick=()=>{de&&de.audio&&(de.audio.muted?(de.audio.muted=!1,Te(P,"active",!1)):(de.audio.muted=!0,Te(P,"active",!0)),P.innerHTML=de.audio.muted?"&#128264;":"&#128266;")},q.onclick=()=>{if(de&&de.sid){const e=de.sid,t=ye.find((t=>t===e));t?ye=ye.filter((t=>t!==e)):ye.unshift(e),Te(q,"Love",!t),Ne(ye,"LikedSongs"),Ye()}},u.onclick=function(){Te(c,"active",!1),Ee(0)},d.onclick=()=>{nt(),Te(c,"active",!1)},v.onclick=()=>nt(),J.onclick=()=>{me.name=B.value.trim();const e={name:me.name,songIds:[...me.songsIds],pid:crypto.randomUUID(),pImg:"logo.png"};Array.isArray(be)||(be=[]),be.push(e),Ne(be,"UserPlaylist"),Te(D,"active",!1),Ye()},window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),Fe=e,f.onclick=function(){Fe.prompt(),Fe.userChoice.then((e=>{"accepted"===e.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),Fe=null}))}}))}));
